<!doctype html>
<head>

  <title>Crowdflower: Ecommerce-Benchmarking</title>


  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- CSS concatenated and minified via ant build script-->
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/d3.css">
  <link rel="stylesheet" href="css/style.css">
  <!-- end CSS-->
</head>

<body>
  <div id="container" class="container">
    <header>
    <h1 class="title">E-commerce Benchmarking</h1>
    <div class="row">
      <div class="span9">
        <div id="legend"></div>
      </div>
      <div class="span3" style="float:right">
        <div id="pie">
          Group Breakdown<br/>
        </div>
      </div>
    </div>
    </header>
    <div class="row">
      <div class="span12">
        <div id="parallel"></div>
        <div id="lists">
          <div id="product-list">
            <div class="groups"></div>
          </div>
        </div>
      </div>
    </div>
    <footer>
    <p>A Crowdflower Infographic</p>
    <p><a href="http://www.blog.crowdflower.com">Blog Post</a> | <!--<a href="https://github.com/vlandham/vlandham.github.com/blob/master/vis/gates/coffee/vis.coffee">Code</a> | --><a href="http://twitter.com/#!/search/Best%20Buy?q=Best+Buy">Data</a></p>
    </footer>
  </div>

  <script src="js/libs/jquery-1.7.2.min.js"></script>
  <script src="js/libs/d3.v2.js"></script>
  <script src="js/libs/d3.layout.min.js"></script>
  <script src="js/libs/d3.csv.min.js"></script>
  <script src="js/libs/underscore.js"></script>
  <script src="js/libs/backbone.js"></script>
  <script src="js/libs/crossfilter.min.js"></script>
  <script src="js/pie.js"></script>
  <script src="js/legend.js"></script>
  <script src="js/parallel.js"></script>
  <script src="js/list.js"></script>
  <script>
    d3.csv("data/ecommerce_data.csv", function(products) {
      var productgroups = ['Automotive', 'Baby', 'Books', 'Clothing', 'Computers', 'Electronics',
                         'Health & Personal Care', 'Home & Kitchen', 'Movies & TV', 'Music',
                         'Sports & Outdoors', 'Other/Misc'],
          distributors = ['Amazon', "Buy.com", 'HSN', 'JCP', "Macy\'s", "Odotco", 'QVC',
                         'Sears', 'Target', 'Walmart'];

      //Creating custom D3 color scheme
      d3.scale.category_custom = function() {
        return d3.scale.ordinal().range(d3_category_custom);
      };

      var d3_category_custom = [
        '#ff7f0e', '#aec7e8', '#555',
        '#ffbb78', '#d62728', '#98df8a',
        '#2ca02c', '#ff9896', '#9467bd',
        '#c5b0d5', '#8c564b', '#c49c94'
      ];

      color = d3.scale.category_custom().range();

      var product = crossfilter(products),
          all = product.groupAll(),
          group = product.dimension(function(d) { return d.group; }),
          aGroup = group.group(),
          name = product.dimension(function(d) {return d.name}),
          amazon = product.dimension(function(d) { return d.Amazon; }),
          aGroup = amazon.group(),
          buy_com = product.dimension(function(d) { return d["Buy.com"]; }),
          bGroup = buy_com.group(),
          hsn = product.dimension(function(d) { return d.HSN; }),
          hGroup = hsn.group(),
          jcp = product.dimension(function(d) { return d.JCP; }),
          jGroup = jcp.group(),
          macys = product.dimension(function(d) { return d["Macy\'s"]; }),
          mGroup = macys.group(),
          odotco = product.dimension(function(d) { return d.Odotco; }), 
          oGroup = odotco.group(),
          qvc = product.dimension(function(d) { return d.QVC; }),
          qGroup = qvc.group(),
          sears = product.dimension(function(d) { return d.Sears; }),
          sGroup = sears.group(),
          target = product.dimension(function(d) { return d.Target; }),
          tGroup = target.group(),
          walmart = product.dimension(function(d) { return d.Walmart; }),
          wGroup = walmart.group();
      var parallel_dimensions = [amazon, aGroup, buy_com, bGroup, hsn, hGroup, jcp, jGroup, macys,
          mGroup, odotco, oGroup, qvc, qGroup, sears, sGroup, target, tGroup, walmart, wGroup];

      var list = d3.selectAll(".list")
        .data([productList]);
      var pie = piegroups(products, productgroups, color, 'group');
      var legend = createLegend().data(productgroups).dimension(group).group(aGroup).call(legend);
      var parallel = createParallel()
        .data(products)
        .axisLabels(distributors)
        .call(parallel);
        //.on("legendClick", renderAll);
      
      var newData = [];

      dispatch.on('legendClick', function(d,i) { 
        console.log(d,i);
        newData = group.filterExact(d);


        /*
        d.disabled = !d.disabled;

        if (!data.filter(function(d) { return !d.disabled }).length) {
          data.map(function(d) {
            d.disabled = false;
            wrap.selectAll('.series').classed('disabled', false);
            return d;
          });
        }

        //selection.transition().call(chart);*/
      });

      function render(method) {
        d3.select(this).call(method);
      }

      function renderAll() {
        parallel(render);
        list.each(render);
        d3.select("#active").text(formatNumber(all.value()));
      }



  });

  window.filter = function(filters) {
    filters.forEach(function(d, i) { charts[i].filter(d); });
    renderAll();
  };

  window.reset = function() {
    parallel.filter(null);
    renderAll();
  };

  </script>
</body>
</html>
